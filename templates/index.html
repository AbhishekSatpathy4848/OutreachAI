<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Autonomous Outreach Agent</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Enhanced Animations */
        .message-fade-in {
            animation: messageSlideIn 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes messageSlideIn {
            0% {
                opacity: 0;
                transform: translateY(30px) scale(0.95);
            }
            100% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .typing-indicator {
            animation: breathe 2s ease-in-out infinite;
        }
        
        @keyframes breathe {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .floating-animation {
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .pulse-glow {
            animation: pulseGlow 2s ease-in-out infinite;
        }
        
        @keyframes pulseGlow {
            0%, 100% { box-shadow: 0 0 20px rgba(99, 102, 241, 0.3); }
            50% { box-shadow: 0 0 40px rgba(99, 102, 241, 0.6); }
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            background-size: 200% 200%;
            animation: gradientShift 8s ease infinite;
        }
        
        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        .glass-effect {
            backdrop-filter: blur(20px);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .glass-card {
            backdrop-filter: blur(16px);
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        
        .hover-lift {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .hover-lift:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        }
        
        .rainbow-border {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #ffeaa7, #fd79a8);
            background-size: 400% 400%;
            animation: rainbowMove 3s ease infinite;
        }
        
        @keyframes rainbowMove {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        .neon-text {
            text-shadow: 0 0 10px rgba(99, 102, 241, 0.8), 0 0 20px rgba(99, 102, 241, 0.6);
        }
        
        .bounce-in {
            animation: bounceIn 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        @keyframes bounceIn {
            0% {
                transform: scale(0.3) rotate(45deg);
                opacity: 0;
            }
            50% {
                transform: scale(1.05) rotate(-10deg);
            }
            70% {
                transform: scale(0.9) rotate(5deg);
            }
            100% {
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
        }
        
        .sparkle {
            position: relative;
            overflow: hidden;
        }
        
        .sparkle::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: conic-gradient(transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: sparkleRotate 2s linear infinite;
        }
        
        @keyframes sparkleRotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .scroll-smooth {
            scroll-behavior: smooth;
        }
        
        /* Particle effect */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }
        
        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: rgba(99, 102, 241, 0.4);
            border-radius: 50%;
            animation: particleFloat 6s ease-in-out infinite;
        }
        
        @keyframes particleFloat {
            0%, 100% {
                transform: translateY(0px) rotate(0deg);
                opacity: 0;
            }
            10%, 90% {
                opacity: 1;
            }
            50% {
                transform: translateY(-100px) rotate(180deg);
            }
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(45deg, #764ba2, #667eea);
        }
    </style>
</head>
<body class="gradient-bg min-h-screen relative" x-data="chatApp()">
    <!-- Particle Background -->
    <div class="particles">
        <div class="particle" style="left: 10%; animation-delay: 0s;"></div>
        <div class="particle" style="left: 20%; animation-delay: 0.5s;"></div>
        <div class="particle" style="left: 30%; animation-delay: 1s;"></div>
        <div class="particle" style="left: 40%; animation-delay: 1.5s;"></div>
        <div class="particle" style="left: 50%; animation-delay: 2s;"></div>
        <div class="particle" style="left: 60%; animation-delay: 2.5s;"></div>
        <div class="particle" style="left: 70%; animation-delay: 3s;"></div>
        <div class="particle" style="left: 80%; animation-delay: 3.5s;"></div>
        <div class="particle" style="left: 90%; animation-delay: 4s;"></div>
    </div>

    <div class="container mx-auto px-4 py-8 max-w-7xl relative z-10">
        <!-- Header -->
        <div class="text-center mb-8 bounce-in">
            <h1 class="text-5xl font-bold text-white mb-4 neon-text floating-animation">
                <i class="fas fa-robot text-white mr-4"></i>
                Autonomous Outreach Agent
            </h1>
            <p class="text-white/80 text-lg mb-6">AI-powered outreach automation for finding and connecting with the right people</p>
        </div>

        <!-- Connection Status -->
        <div class="mb-6 flex justify-center bounce-in">
            <div class="glass-effect rounded-full px-6 py-3 hover-lift">
                <div class="flex items-center space-x-6">
                    <div class="flex items-center space-x-2">
                        <div class="w-3 h-3 rounded-full" :class="connected ? 'bg-green-400 pulse-glow' : 'bg-red-400'"></div>
                        <span class="text-white font-medium" x-text="connected ? 'Connected' : 'Disconnected'"></span>
                    </div>
                    <div class="w-px h-4 bg-white/30"></div>
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-id-card text-white/70"></i>
                        <span class="text-white/70 font-mono text-sm" x-text="sessionId ? sessionId.substring(0, 8) + '...' : 'None'"></span>
                    </div>
                    <div class="w-px h-4 bg-white/30"></div>
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-comments text-white/70"></i>
                        <span class="text-white/70" x-text="`${messages.length} messages`"></span>
                    </div>
                    <div class="w-px h-4 bg-white/30" x-show="isProcessing"></div>
                    <div class="flex items-center space-x-2" x-show="isProcessing">
                        <i class="fas fa-cog fa-spin text-yellow-400"></i>
                        <span class="text-yellow-400">Processing...</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
            <!-- Main Chat Area -->
            <div class="lg:col-span-3">
                <div class="glass-card rounded-2xl h-96 lg:h-[700px] flex flex-col hover-lift sparkle">
                    <!-- Chat Header -->
                    <div class="flex items-center justify-between p-6 border-b border-white/10">
                        <div class="flex items-center space-x-3">
                            <div class="rainbow-border p-0.5 rounded-full">
                                <div class="bg-white rounded-full p-2">
                                    <i class="fas fa-robot text-2xl text-indigo-600"></i>
                                </div>
                            </div>
                            <div>
                                <h3 class="font-bold text-gray-800 text-lg">Chat Assistant</h3>
                                <p class="text-gray-500 text-sm" x-show="isProcessing">Thinking...</p>
                                <p class="text-gray-500 text-sm" x-show="!isProcessing && connected">Ready to help</p>
                                <p class="text-gray-500 text-sm" x-show="!connected">Offline</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button @click="clearChat()" :disabled="!connected" 
                                    class="p-2 rounded-full bg-gray-100 hover:bg-gray-200 transition-colors disabled:opacity-50 hover-lift">
                                <i class="fas fa-trash text-gray-600 text-sm"></i>
                            </button>
                            <button @click="getSummary()" :disabled="!connected" 
                                    class="p-2 rounded-full bg-indigo-100 hover:bg-indigo-200 transition-colors disabled:opacity-50 hover-lift">
                                <i class="fas fa-chart-bar text-indigo-600 text-sm"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Messages Area -->
                    <div class="flex-1 overflow-y-auto p-6 space-y-4 scroll-smooth" id="messages-container">
                        <template x-for="message in messages" :key="message.id">
                            <div class="message-fade-in" :class="getMessageClass(message.type)">
                                <div class="flex items-start space-x-4">
                                    <div class="flex-shrink-0 mt-1">
                                        <div class="p-2 rounded-full" :class="getMessageIconBg(message.type)">
                                            <i :class="getMessageIcon(message.type)" class="text-sm"></i>
                                        </div>
                                    </div>
                                    <div class="flex-1 min-w-0">
                                        <div class="flex items-center space-x-2 mb-2">
                                            <span class="font-semibold text-sm" x-text="getMessageLabel(message.type)"></span>
                                            <span class="text-xs text-gray-400" x-text="formatTime(message.timestamp)"></span>
                                        </div>
                                        <div class="text-sm leading-relaxed" x-html="formatMessageContent(message)"></div>
                                    </div>
                                </div>
                            </div>
                        </template>
                        
                        <!-- Enhanced Typing Indicator -->
                        <div x-show="isProcessing" class="typing-indicator">
                            <div class="flex items-center space-x-4 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-2xl border border-blue-100">
                                <div class="rainbow-border p-0.5 rounded-full">
                                    <div class="bg-white rounded-full p-2">
                                        <i class="fas fa-robot text-indigo-600"></i>
                                    </div>
                                </div>
                                <div class="flex flex-col">
                                    <span class="text-sm font-medium text-gray-700">Agent is thinking...</span>
                                    <div class="flex space-x-1 mt-2">
                                        <div class="w-2 h-2 bg-indigo-400 rounded-full animate-bounce"></div>
                                        <div class="w-2 h-2 bg-indigo-400 rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
                                        <div class="w-2 h-2 bg-indigo-400 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Empty state -->
                        <div x-show="messages.length === 0 && !isProcessing" class="text-center py-12 bounce-in">
                            <div class="floating-animation mb-6">
                                <i class="fas fa-comments text-6xl text-gray-300"></i>
                            </div>
                            <h3 class="text-xl font-semibold text-gray-600 mb-2">Start a conversation</h3>
                            <p class="text-gray-400">Ask me to find people, analyze profiles, or help with outreach!</p>
                        </div>
                    </div>

                    <!-- Enhanced Input Area -->
                    <div class="border-t border-white/10 p-6">
                        <form @submit.prevent="sendMessage()" class="flex space-x-4">
                            <div class="flex-1 relative">
                                <input 
                                    type="text" 
                                    x-model="currentMessage" 
                                    :disabled="!connected || isProcessing"
                                    class="w-full px-6 py-4 pr-12 bg-gray-50 border-2 border-gray-200 rounded-2xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent disabled:bg-gray-100 transition-all duration-300 text-gray-700 placeholder-gray-400"
                                    placeholder="Type your message here... ‚ú®"
                                    @focus="$el.classList.add('pulse-glow')"
                                    @blur="$el.classList.remove('pulse-glow')"
                                >
                                <div class="absolute right-4 top-1/2 transform -translate-y-1/2">
                                    <i class="fas fa-magic text-gray-400"></i>
                                </div>
                            </div>
                            <button 
                                type="submit" 
                                :disabled="!connected || isProcessing || !currentMessage.trim()"
                                class="px-8 py-4 bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-2xl hover:from-indigo-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed hover-lift sparkle font-semibold"
                            >
                                <i class="fas fa-paper-plane mr-2"></i>
                                Send
                            </button>
                        </form>
                        <div class="mt-4 text-xs text-gray-500 flex items-center justify-center space-x-4">
                            <span><i class="fas fa-lightbulb mr-1 text-yellow-400"></i>Try asking about AI experts or marketing influencers</span>
                            <span><i class="fas fa-rocket mr-1 text-blue-400"></i>Powered by advanced AI</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="space-y-6">
                <!-- Quick Actions -->
                <div class="bg-white rounded-lg shadow-lg p-4">
                    <h3 class="text-lg font-semibold mb-4 flex items-center">
                        <i class="fas fa-bolt text-yellow-500 mr-2"></i>
                        Quick Actions
                    </h3>
                    <div class="space-y-2">
                        <button @click="startNewSession()" :disabled="isProcessing" class="w-full px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:bg-gray-400">
                            <i class="fas fa-play mr-2"></i>
                            New Session
                        </button>
                        <button @click="getSummary()" :disabled="!connected" class="w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:bg-gray-400">
                            <i class="fas fa-chart-bar mr-2"></i>
                            Get Summary
                        </button>
                        <button @click="endSession()" :disabled="!connected" class="w-full px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:bg-gray-400">
                            <i class="fas fa-stop mr-2"></i>
                            End Session
                        </button>
                    </div>
                </div>

                <!-- Session Summary -->
                <div x-show="summary" class="bg-white rounded-lg shadow-lg p-4">
                    <h3 class="text-lg font-semibold mb-4 flex items-center">
                        <i class="fas fa-chart-pie text-purple-500 mr-2"></i>
                        Session Summary
                    </h3>
                    <template x-if="summary">
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span class="text-gray-600">Query:</span>
                                <span class="font-medium text-sm" x-text="summary.raw_user_query"></span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Candidates:</span>
                                <span class="font-medium" x-text="summary.candidates_found"></span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Top Candidates:</span>
                                <span class="font-medium" x-text="summary.top_candidates"></span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Outreach Messages:</span>
                                <span class="font-medium" x-text="summary.outreach_messages"></span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Function Calls:</span>
                                <span class="font-medium" x-text="summary.function_calls"></span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Errors:</span>
                                <span class="font-medium text-red-600" x-text="summary.errors"></span>
                            </div>
                        </div>
                    </template>
                </div>

                <!-- Example Queries -->
                <div class="glass-card rounded-2xl p-6 hover-lift">
                    <h3 class="text-xl font-bold mb-6 flex items-center text-gray-800">
                        <div class="rainbow-border p-0.5 rounded-full mr-3">
                            <div class="bg-white rounded-full p-2">
                                <i class="fas fa-lightbulb text-yellow-500"></i>
                            </div>
                        </div>
                        Example Queries
                    </h3>
                    <div class="space-y-3">
                        <template x-for="(example, index) in exampleQueries" :key="index">
                            <button 
                                @click="currentMessage = example; sendMessage()" 
                                :disabled="!connected || isProcessing"
                                class="w-full text-left px-4 py-3 text-sm bg-gradient-to-r from-gray-50 to-gray-100 hover:from-indigo-50 hover:to-purple-50 border border-gray-200 hover:border-indigo-300 rounded-xl transition-all duration-300 disabled:opacity-50 hover-lift"
                                x-text="example">
                            </button>
                        </template>
                    </div>
                    <div class="mt-6 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-200">
                        <div class="flex items-center space-x-2 text-sm text-blue-700">
                            <i class="fas fa-info-circle"></i>
                            <span class="font-medium">Pro Tip:</span>
                        </div>
                        <p class="text-xs text-blue-600 mt-1">Be specific with your requests for better results!</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function chatApp() {
            return {
                sessionId: null,
                connected: false,
                eventSource: null,
                messages: [],
                currentMessage: '',
                isProcessing: false,
                summary: null,
                messageIdCounter: 0,
                exampleQueries: [
                    "Find me 5 AI podcast guests with large audiences",
                    "Search for marketing influencers in the tech space",
                    "Find YouTube creators focused on personal development",
                    "Look for startup founders in the fintech space",
                    "Find speakers for a tech conference about AI"
                ],

                init() {
                    this.startNewSession();
                },

                async startNewSession() {
                    try {
                        const response = await fetch('/start_session', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' }
                        });
                        const data = await response.json();
                        
                        if (data.session_id) {
                            this.sessionId = data.session_id;
                            this.connectToStream();
                            this.addMessage('system', 'New session started! How can I help you find and connect with the right people?');
                        }
                    } catch (error) {
                        console.error('Error starting session:', error);
                        this.addMessage('error', 'Failed to start session');
                    }
                },

                connectToStream() {
                    if (this.eventSource) {
                        this.eventSource.close();
                    }

                    this.eventSource = new EventSource(`/stream/${this.sessionId}`);
                    
                    this.eventSource.onopen = () => {
                        this.connected = true;
                    };

                    this.eventSource.onmessage = (event) => {
                        try {
                            const data = JSON.parse(event.data);
                            this.handleStreamMessage(data);
                        } catch (error) {
                            console.error('Error parsing stream message:', error);
                        }
                    };

                    this.eventSource.onerror = () => {
                        this.connected = false;
                        this.isProcessing = false;
                    };
                },

                handleStreamMessage(data) {
                    if (data.type === 'heartbeat') {
                        return;
                    }

                    // Handle different message types
                    switch(data.type) {
                        case 'connected':
                            // Connection established
                            break;
                            
                        case 'user_message':
                            // Don't add user messages here - they're added immediately when sent
                            break;
                            
                        case 'agent_thought':
                            this.addMessage('agent_thought', data.content, data.timestamp);
                            break;
                            
                        case 'display_message':
                            this.addMessage('display_message', data.content, data.timestamp);
                            break;
                            
                        case 'function_call':
                            this.addMessage('function_call', data.content, data.timestamp);
                            break;
                            
                        case 'function_result':
                            this.addMessage('function_result', data.content, data.timestamp);
                            break;
                            
                        case 'input_request':
                            // Agent is requesting input - enable the input field
                            this.addMessage('input_request', data.content, data.timestamp);
                            this.isProcessing = false; // Enable input
                            break;
                            
                        case 'completion':
                            this.addMessage('completion', data.content, data.timestamp);
                            this.isProcessing = false;
                            break;
                            
                        case 'error':
                            this.addMessage('error', data.content, data.timestamp);
                            this.isProcessing = false;
                            break;
                            
                        case 'info':
                            this.addMessage('display_message', data.content, data.timestamp);
                            break;
                            
                        default:
                            this.addMessage(data.type, data.content, data.timestamp);
                    }
                },

                async sendMessage() {
                    if (!this.currentMessage.trim() || !this.connected || this.isProcessing) {
                        return;
                    }

                    const message = this.currentMessage.trim();
                    this.currentMessage = '';
                    this.isProcessing = true;

                    this.addMessage('user_message', message);

                    try {
                        await fetch('/send_message', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                session_id: this.sessionId,
                                message: message
                            })
                        });
                    } catch (error) {
                        console.error('Error sending message:', error);
                        this.addMessage('error', 'Failed to send message');
                        this.isProcessing = false;
                    }
                },

                addMessage(type, content, timestamp = null) {
                    this.messages.push({
                        id: ++this.messageIdCounter,
                        type: type,
                        content: content,
                        timestamp: timestamp || new Date().toISOString()
                    });
                    
                    this.$nextTick(() => {
                        const container = document.getElementById('messages-container');
                        container.scrollTop = container.scrollHeight;
                    });
                },

                async getSummary() {
                    if (!this.connected) return;

                    try {
                        const response = await fetch(`/get_summary/${this.sessionId}`);
                        const data = await response.json();
                        this.summary = data;
                    } catch (error) {
                        console.error('Error getting summary:', error);
                    }
                },

                async endSession() {
                    if (!this.connected) return;

                    try {
                        await fetch(`/end_session/${this.sessionId}`, { method: 'POST' });
                        if (this.eventSource) {
                            this.eventSource.close();
                        }
                        this.connected = false;
                        this.sessionId = null;
                        this.addMessage('system', 'Session ended');
                    } catch (error) {
                        console.error('Error ending session:', error);
                    }
                },

                clearChat() {
                    this.messages = [];
                    this.summary = null;
                },

                getMessageClass(type) {
                    const baseClass = "p-3 rounded-lg ";
                    switch (type) {
                        case 'user_message':
                            return baseClass + "bg-blue-100 border-l-4 border-blue-500";
                        case 'message':
                        case 'agent_thought':
                            return baseClass + "bg-green-100 border-l-4 border-green-500";
                        case 'display_message':
                            return baseClass + "bg-purple-100 border-l-4 border-purple-500";
                        case 'function_call':
                            return baseClass + "bg-yellow-100 border-l-4 border-yellow-500";
                        case 'function_result':
                            return baseClass + "bg-cyan-100 border-l-4 border-cyan-500";
                        case 'input_request':
                            return baseClass + "bg-orange-100 border-l-4 border-orange-500 border-2 border-dashed";
                        case 'user_input_response':
                            return baseClass + "bg-blue-200 border-l-4 border-blue-600";
                        case 'error':
                            return baseClass + "bg-red-100 border-l-4 border-red-500";
                        case 'system':
                            return baseClass + "bg-gray-100 border-l-4 border-gray-500";
                        default:
                            return baseClass + "bg-gray-50 border-l-4 border-gray-300";
                    }
                },

                getMessageIcon(type) {
                    switch (type) {
                        case 'user_message':
                            return "fas fa-user text-blue-500";
                        case 'message':
                        case 'agent_thought':
                            return "fas fa-robot text-green-500";
                        case 'display_message':
                            return "fas fa-comment-dots text-purple-500";
                        case 'function_call':
                            return "fas fa-cog text-yellow-500";
                        case 'function_result':
                            return "fas fa-check-circle text-cyan-500";
                        case 'input_request':
                            return "fas fa-question-circle text-orange-500 animate-pulse";
                        case 'user_input_response':
                            return "fas fa-reply text-blue-600";
                        case 'error':
                            return "fas fa-exclamation-triangle text-red-500";
                        case 'system':
                            return "fas fa-info-circle text-gray-500";
                        default:
                            return "fas fa-comment text-gray-400";
                    }
                },

                getMessageIconBg(type) {
                    switch (type) {
                        case 'user_message':
                            return "bg-blue-100";
                        case 'message':
                        case 'agent_thought':
                            return "bg-green-100";
                        case 'display_message':
                            return "bg-purple-100";
                        case 'function_call':
                            return "bg-yellow-100";
                        case 'function_result':
                            return "bg-cyan-100";
                        case 'input_request':
                            return "bg-orange-100";
                        case 'user_input_response':
                            return "bg-blue-200";
                        case 'error':
                            return "bg-red-100";
                        case 'system':
                            return "bg-gray-100";
                        default:
                            return "bg-gray-50";
                    }
                },

                getMessageLabel(type) {
                    switch (type) {
                        case 'user_message':
                            return "You";
                        case 'message':
                            return "Agent";
                        case 'agent_thought':
                            return "Agent Thinking";
                        case 'display_message':
                            return "Agent Message";
                        case 'function_call':
                            return "Function Call";
                        case 'function_result':
                            return "Result";
                        case 'input_request':
                            return "Input Required";
                        case 'user_input_response':
                            return "Your Response";
                        case 'error':
                            return "Error";
                        case 'system':
                            return "System";
                        default:
                            return "Unknown";
                    }
                },

                formatMessageContent(message) {
                    let content = message.content;
                    
                    if (typeof content === 'object') {
                        if (message.type === 'function_call') {
                            const funcName = content.name || 'Unknown Function';
                            const inputs = content.inputs || {};
                            
                            let formattedInputs = '';
                            if (Object.keys(inputs).length > 0) {
                                formattedInputs = '<br><small class="text-gray-600">Parameters:</small><br>';
                                for (const [key, value] of Object.entries(inputs)) {
                                    formattedInputs += `<span class="text-sm"><strong>${key}:</strong> ${typeof value === 'string' ? value : JSON.stringify(value)}</span><br>`;
                                }
                            }
                            
                            return `<strong>üîß Executing: ${funcName}</strong>${formattedInputs}`;
                        }
                        
                        if (message.type === 'function_result') {
                            // Format function results in a user-friendly way
                            if (content.scored_candidates) {
                                return `<strong>‚úÖ Scored ${content.total_scored || content.scored_candidates.length} candidates</strong><br><small class="text-gray-600">Method: ${content.method || 'AI-based'}</small>`;
                            }
                            
                            if (content.outreach_messages) {
                                return `<strong>üìß Generated ${content.total_prepared || Object.keys(content.outreach_messages).length} outreach messages</strong><br><small class="text-gray-600">Status: ${content.status || 'completed'}</small>`;
                            }
                            
                            if (Array.isArray(content)) {
                                return `<strong>üìã Found ${content.length} results</strong><br><small class="text-gray-600">Ready for processing</small>`;
                            }
                            
                            if (typeof content === 'string') {
                                return content;
                            }
                            
                            // Fallback for other objects - show key info only
                            const keys = Object.keys(content);
                            if (keys.length === 0) {
                                return '<em>No data returned</em>';
                            }
                            
                            return `<strong>Result:</strong> ${keys.length} properties returned<br><small class="text-gray-600">${keys.slice(0, 3).join(', ')}${keys.length > 3 ? '...' : ''}</small>`;
                        }
                        
                        // For other object types, try to format nicely
                        return `<pre class="text-xs overflow-x-auto bg-gray-50 p-2 rounded">${JSON.stringify(content, null, 2)}</pre>`;
                    }
                    
                    // Handle string content
                    if (typeof content === 'string') {
                        // Convert URLs to links
                        content = content.replace(/(https?:\/\/[^\s]+)/g, '<a href="$1" target="_blank" class="text-blue-600 hover:underline">$1</a>');
                        
                        // Convert line breaks
                        content = content.replace(/\n/g, '<br>');
                        
                        // Add emoji for common patterns
                        if (message.type === 'display_message') {
                            if (content.includes('Successfully') || content.includes('‚úÖ')) {
                                content = content.replace(/^/, '');
                            } else if (content.includes('Error') || content.includes('‚ùå')) {
                                content = content.replace(/^/, '');
                            } else if (content.includes('Searching') || content.includes('Finding')) {
                                content = content.replace(/^/, 'üîç ');
                            } else if (content.includes('Scoring') || content.includes('Analyzing')) {
                                content = content.replace(/^/, 'üìä ');
                            } else if (content.includes('Generated') || content.includes('Preparing')) {
                                content = content.replace(/^/, '‚úçÔ∏è ');
                            }
                        }
                    }
                    
                    return content;
                },

                formatTime(timestamp) {
                    return new Date(timestamp).toLocaleTimeString();
                }
            }
        }
    </script>
</body>
</html>
